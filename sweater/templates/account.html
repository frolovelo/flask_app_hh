{% extends 'base.html' %}

{% block title %}
Кабинет {{ current_user.login }}
{% endblock %}

{% block body %}

    <div class="login-container">
    <h1>Личный кабинет</h1>
    <hr>
    <p>ID: {{ current_user.id }}</p>
    <p>Никнейм: {{ current_user.nickname }}</p>
    <p>Логин: {{ current_user.login }}</p>
    <hr>
    <p><a href="{{ url_for('logout') }}">Выйти из аккаунта</a></p>
    <button class="btn btn-danger" id="open-modal-btn">Удалить аккаунт</button>
    </div>

<!-- Модальное окно -->
    <div class="modal" id="my-modal">
        <div class="modal-content">
            <button class="btn-close" id="cancel-deletex-btn"></button>
            <p>Вы уверены, что хотите удалить аккаунт?</p>
            <p class="blinking-text">Ваши записи также будут удалены!</p>
            <button class="btn btn-danger" id="confirm-delete-btn">Да, удалить</button>
            <button class="btn btn-primary" id="cancel-delete-btn">Отмена</button>
        </div>
    </div>

    <script defer>
    const openModalButton = document.getElementById("open-modal-btn");
        const modal = document.getElementById("my-modal");
        const confirmDeleteButton = document.getElementById("confirm-delete-btn");
        const cancelDeleteButton = document.getElementById("cancel-delete-btn");
        const cancelxDeleteButton = document.getElementById("cancel-deletex-btn");

        openModalButton.addEventListener("click", function () {
            modal.style.display = "flex";
        });

        confirmDeleteButton.addEventListener("click", function () {
            // Отправляем POST-запрос на URL '/delete_account'
            fetch("/delete_account", {
                method: "POST",
            })
            .then(response => {
                if (response.status === 200) {
                    // Успешный ответ от сервера
                    window.location.href = "/index";
                } else {
                    // Обработка ошибки, если есть
                    console.error("Произошла ошибка: " + response.status);
                }
            })
            .catch(error => {
                // Обработка ошибок сети или других ошибок
                console.error("Произошла ошибка: " + error);
            });
        });

        cancelDeleteButton.addEventListener("click", function () {
            modal.style.display = "none"; // Закрыть модальное окно при отмене
        });

        cancelxDeleteButton.addEventListener("click", function () {
            modal.style.display = "none"; // Закрыть модальное окно при отмене
        });
    </script>
{% endblock %}